## webpack

### tree-shaking

- 定义：是一种删除不需要的额外代码的优化方式

- 原理：
  - 根据 ES6 Module 静态分析，判断编译的时候加载了哪些模块
  - 判断哪些模块和变量未使用，进而删除

### babel 是什么，怎么做到的

- 作用：帮助浏览器解决 js 兼容问题的技术
- 工作机制：
  - 语法检查
    - 会按照自己 babel 的版本和配置对代码进行解析
    - 有不支持的语法，会报错
  - 语法转译
    - 按照你配置的目标环境，将语法转换降级到目标环境可以解析的语法
  - polyfill 导入
    - 用来解决浏览器各种新方法、对象的兼容，如 Array.from，Promise 等等(现在用 core.js)
- 注意：
  - 主要依靠的是 AST 语法树，会按照你的配置，遍历相关节点，语法检查就是在 AST 语法树做的；polyfill 阶段是找出不支持的方法和 API，将其对应的 polyfill 模块进行导入

### webpack 工作流程

#### 初始化阶段

- 初始化参数：配置文件、配置对象与默认参数进行合并
- 创建编译对象：用上一步得到的参数创建 Compiler 对象
- 初始化编译环境：注入内置插件，加载配置的插件

#### 构建阶段

- 开始编译：执行 Compiler 对象的 run 方法，创建 Compilation 对象。
- 确认编译入口：进入 entryOption 阶段，读取配置的 Entries，递归遍历所有的入
  口文件，调用 Compilation.addEntry 将入口文件转换为 Dependency 对象
- 编译模块：调用 normalModule 中的 build 开启构建，从 entry 文件
  开始，调用 loader 对模块进行转译处理，然后调用 JS 解释器（acorn）将内容转 化为 AST 对象，然后递归分析依赖，依次处理全部文件。
- 完成模块编译：在上一步处理好所有模块后，得到模块编译产物和依赖关系图

#### 生成阶段

- 输出资源：根据入口和模块之间的依赖关系，组装成多个包含多个模块的
  Chunk，再把每个 Chunk 转换成一个 Asset 加入到输出列表，这步是可以修改输 出内容的最后机会。
  写入文件系统（emitAssets） ：确定好输出内容后，根据配置的 output 将内容写
  入文件系统。

### webpack 热更新机制原理

- 定义：不需要刷新整个页面，只要更新页面的局部完成更新
- 实现原理：
  - 启动 webpack，生成 compiler 实例，compiler 实例的功能很多，比如用来启动 webpack 的编译工作，监听文件变化等。
  - 使用 Express 启动一个本地服务，使得浏览器可以访问本地服务
  - 启动 websocket 服务，用于浏览器和本地 node 服务进行通讯。
