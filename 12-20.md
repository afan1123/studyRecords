# 异步编程

## Promise

### 三种状态

- pendding（待定）：初始状态
- fulfilled（已实现）：操作成功
- rejected（已拒绝）：操作失败
- 注意：
  - 只能单向转换：pendding-->fulfilled，pendding-->rejected

### 静态方法

- all：全部 Promise 执行成功，或者任意一个执行失败
- allSettled：执行多个 Promise，不论成功失败，结果全部返回
- any：接受一个 Promise 集合，返回第一个成功者
- race：Promise 集合中，返回最快的 Promise 触发结果
- resolve：返回一个解析过参数的 Promise 对象
- reject：返回一个状态为失败的 Promise 对象

### 原型方法

- prototype.then：返回一个 Promise，最多两个参数，成功和失败后的回调函数
- prototype.catch：返回一个 Promise，并处理拒绝的情况
- prototype.finally：返回一个 Promise,在 Promise 结束时，无论成功还是失败，都执行该回调

补充

### 延迟方法

```js
function delay(fn, delay, context) {
  let defaultDelay = delay || 5000;
}
```

## Generator 函数/生成器函数

```js
// 是一个普通函数
(function* generator() {} instanceof Function); // true
```

### 特征

- 星号：function 关键字与函数名之间有一个星号
- yield 表达式

### generator 对象

- 定义：generator 函数执行后返回的对象
- 方法：
  - prototype.next()：获取下一个状态
  - prototype.return()：给定的值并结束生成器
  - prototype.throw()：抛出异常

补充

### async 本质

补充

## 基于 Promise 的通用异步方案

### 基于事件通讯的场景

- 与服务端通讯：WebSocket，socketIO，mqtt，SSE 等
- 客户端相互之间：webview 与原生，页面与 iframe，EventEmitter 订阅发布中心等等
- 一发一收：类似于 http 请求，一次发送只期待一次返回的结果
- 单纯的接受。希望接收到服务的信息。比如直播业务，监听礼物消息，主播知道有人打赏了。

### 一发一收

补充
