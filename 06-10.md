## ES6+

### Proxy å’Œ Reflect åŒºåˆ«

- Reflect
  - å®šä¹‰ï¼šæ˜¯å†…ç½®å¯¹è±¡ï¼Œä¸éœ€è¦å®ä¾‹åŒ–ï¼Œæä¾›äº†æ–¹æ³•æ¥æ“ä½œå¯¹è±¡ã€‚
  - ä½¿ç”¨åœºæ™¯ï¼šå¯¹å¯¹è±¡çš„å±æ€§è·å–ã€è®¾ç½®ã€åˆ é™¤
  - Apiï¼š
    - Reflect.ownKeys(target)ï¼šè¿”å›å¯¹è±¡å±æ€§
    - Reflect.getOwnPropertyDescriptor(target, name)ï¼šæŒ‡å®šå±æ€§çš„æè¿°å¯¹è±¡ã€‚
    - Reflect.getPrototypeOf(target)ï¼šç›¸å½“äºè·å–ã€\_\_proro\_\_å±æ€§
    - Reflect.setPrototypeOf(target, prototype)ï¼šè®¾ç½®ç›®æ ‡å¯¹è±¡çš„åŸå‹
    - Reflect.has(target, name)ï¼šfor in
    - Reflect.get(target, name, receiver)ï¼šè·å–å±æ€§
    - Reflect.set(target, name, value, receiver)ï¼šè®¾ç½®å±æ€§
    - ......
- Proxy
  - å®šä¹‰ï¼šProxy æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œéœ€è¦å®ä¾‹åŒ–ï¼Œåˆ›é€ ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œä»£ç†å¯¹è±¡é€šè¿‡æ‹¦æˆªå™¨æ–¹æ³•æ¥å®šåˆ¶å¯¹ç›®æ ‡å¯¹è±¡çš„æ“ä½œè¡Œä¸º
  - ä½¿ç”¨åœºæ™¯ï¼šå®ç°æ•°æ®ç»‘å®šã€æ‹¦æˆªå™¨ã€ç¼“å­˜ç­‰é«˜çº§çš„å…ƒç¼–ç¨‹åŠŸèƒ½ã€‚Proxy çš„ä½¿ç”¨åœºæ™¯åŒ…æ‹¬å±æ€§æ‹¦æˆªã€å‡½æ•°è°ƒç”¨æ‹¦æˆªã€æ„é€ å‡½æ•°æ‹¦æˆªç­‰ã€‚
  - Apiï¼š
    - get(target, propKey, receiver)ï¼šè·å–å±æ€§
    - set(target, propKey, value, receiver)ï¼šè®¾ç½®å±æ€§
    - has(target, propKey)ï¼šåˆ¤æ–­æ˜¯å¦æœ‰å±æ€§
    - ownKeys(target)ï¼šè¿”å›è‡ªèº«å±æ€§
    - setPrototypeOf(target, proto)ï¼šè®¾ç½®ç›®æ ‡å¯¹è±¡çš„åŸå‹
    - ......

### set å’Œ weakSet åŒºåˆ«

- set
  - å®šä¹‰ï¼šæ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œéœ€è¦å®ä¾‹åŒ–ï¼Œåˆ›é€ ä¸€ä¸ª set é›†åˆï¼Œå…¶ä¸­å…ƒç´ ä¸èƒ½é‡å¤
  - ä½¿ç”¨åœºæ™¯ï¼šå»é‡
  - Apiï¼š
    - addï¼šæ·»åŠ å…ƒç´ 
    - deleteï¼šåˆ é™¤
    - hasï¼šåˆ¤æ–­æ˜¯å¦æœ‰å€¼
    - sizeï¼šé•¿åº¦
    - clearï¼šæ¸…ç©º
    - keys/valuesï¼šéå†å±æ€§ï¼Œç»“æœéƒ½ä¸€æ ·
    - forEach/entriesï¼šéå†å±æ€§ï¼Œç»“æœéƒ½ä¸€æ ·
- weakSetï¼š
  - å®šä¹‰ï¼šåŒä¸Šï¼Œä½†ä¸ç”¨åƒåœ¾å›æ”¶
  - åŒºåˆ«ï¼šæ²¡æœ‰ sizeï¼Œclearï¼Œä¸èƒ½ç”¨ for ... of è¿›è¡Œéå†

## OOPï¼ˆé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼‰

### è®¾è®¡æ¨¡å¼

#### å·¥å‚æ¨¡å¼

- ç®€å•å·¥å‚æ¨¡å¼ï¼šå°†æ„å»ºå¯¹è±¡çš„è¿‡ç¨‹å•ç‹¬çš„å°è£…ï¼Œè§£è€¦ç”¨æˆ·ä¸å¯¹è±¡ã€‚

  ```js
  function User(name , age, career, work) {
  this.name = name
  this.age = age
  this.career = career
  this.work = work
  }
  //å®ç°äº†ä¸åŒèŒä¸šå¯¹åº”ä¸åŒå®ä¾‹çš„é€»è¾‘
  function Factory(name, age, career) {
  let work
  switch(career) {
      case 'coder':
          work =  ['å†™ä»£ç ','å†™ç³»åˆ†', 'ä¿®Bug']
          break
      case 'product manager':
          work = ['è®¢ä¼šè®®å®¤', 'å†™PRD', 'å‚¬æ›´']
          break
      case 'boss':
          work = ['å–èŒ¶', 'çœ‹æŠ¥', 'è§å®¢æˆ·']
      case 'xxx':
          // å…¶å®ƒå·¥ç§çš„èŒè´£åˆ†é…
          ...

  return new User(name, age, career, work)
  }
  ```

- æŠ½è±¡å·¥å‚æ¨¡å¼ï¼šå›´ç»•ä¸€ä¸ªè¶…çº§å·¥å‚åˆ›å»ºå…¶ä»–å·¥å‚ï¼ˆç»§æ‰¿ï¼‰

  ```js
  // å®šä¹‰æ“ä½œç³»ç»Ÿè¿™ç±»äº§å“çš„æŠ½è±¡äº§å“ç±»
  class OS {
    controlHardWare() {
      throw new Error('æŠ½è±¡äº§å“æ–¹æ³•ä¸å…è®¸ç›´æ¥è°ƒç”¨ï¼Œä½ éœ€è¦å°†æˆ‘é‡å†™ï¼');
    }
  }

  // å®šä¹‰å…·ä½“æ“ä½œç³»ç»Ÿçš„å…·ä½“äº§å“ç±»
  class AndroidOS extends OS {
    controlHardWare() {
      console.log('æˆ‘ä¼šç”¨å®‰å“çš„æ–¹å¼å»æ“ä½œç¡¬ä»¶');
    }
  }

  class AppleOS extends OS {
    controlHardWare() {
      console.log('æˆ‘ä¼šç”¨ğŸçš„æ–¹å¼å»æ“ä½œç¡¬ä»¶');
    }
  }
  // è¿™æ˜¯æˆ‘çš„æ‰‹æœº
  const myPhone = new FakeStarFactory();
  // è®©å®ƒæ‹¥æœ‰æ“ä½œç³»ç»Ÿ
  const myOS = myPhone.createOS();
  // è®©å®ƒæ‹¥æœ‰ç¡¬ä»¶
  const myHardWare = myPhone.createHardWare();
  // å¯åŠ¨æ“ä½œç³»ç»Ÿ(è¾“å‡ºâ€˜æˆ‘ä¼šç”¨å®‰å“çš„æ–¹å¼å»æ“ä½œç¡¬ä»¶â€™)
  myOS.controlHardWare();
  // å”¤é†’ç¡¬ä»¶(è¾“å‡ºâ€˜æˆ‘ä¼šç”¨é«˜é€šçš„æ–¹å¼å»è¿è½¬â€™)
  myHardWare.operateByOrder();
  ```

#### å•ä¾‹æ¨¡å¼

- å®šä¹‰ï¼šä¿è¯ä¸€ä¸ªç±»ä»…æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œç”¨äºæ¨¡æ€æ¡†ç­‰

```js
class SingleDog {
  show() {
    console.log('æˆ‘æ˜¯ä¸€ä¸ªå•ä¾‹å¯¹è±¡');
  }
  static getInstance() {
    // åˆ¤æ–­æ˜¯å¦å·²ç»newè¿‡1ä¸ªå®ä¾‹
    if (!SingleDog.instance) {
      // è‹¥è¿™ä¸ªå”¯ä¸€çš„å®ä¾‹ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå…ˆåˆ›å»ºå®ƒ
      SingleDog.instance = new SingleDog();
    }
    // å¦‚æœè¿™ä¸ªå”¯ä¸€çš„å®ä¾‹å·²ç»å­˜åœ¨ï¼Œåˆ™ç›´æ¥è¿”å›
    return SingleDog.instance;
  }
}

const s1 = SingleDog.getInstance();
const s2 = SingleDog.getInstance();

// true
s1 === s2;
```

### åŸå‹æ¨¡å¼

- å®šä¹‰ï¼šç”¨åŸå‹å…‹éš†çš„æ–¹å¼æ¥å®ç°å¯¹è±¡çš„åˆ›å»ºå’ŒåŸå‹çš„ç»§æ‰¿ï¼Œå¦‚ Object.create

### è£…é¥°å™¨æ¨¡å¼

- å®šä¹‰ï¼šä¸ä¼šå¯¹åŸæœ‰çš„åŠŸèƒ½äº§ç”Ÿä»»ä½•å½±å“ï¼Œä»…ä»…æ˜¯ä½¿äº§å“å…·å¤‡äº†ä¸€ç§æ–°çš„èƒ½åŠ›

```js
// å®šä¹‰æ‰“å¼€æŒ‰é’®
class OpenButton {
  // ç‚¹å‡»åå±•ç¤ºå¼¹çª—ï¼ˆæ—§é€»è¾‘ï¼‰
  onClick() {
    const modal = new Modal();
    modal.style.display = 'block';
  }
}

// å®šä¹‰æŒ‰é’®å¯¹åº”çš„è£…é¥°å™¨
class Decorator {
  // å°†æŒ‰é’®å®ä¾‹ä¼ å…¥
  constructor(open_button) {
    this.open_button = open_button;
  }

  onClick() {
    this.open_button.onClick();
    // â€œåŒ…è£…â€äº†ä¸€å±‚æ–°é€»è¾‘
    this.changeButtonStatus();
  }

  changeButtonStatus() {
    this.changeButtonText();
    this.disableButton();
  }

  disableButton() {
    const btn = document.getElementById('open');
    btn.setAttribute('disabled', true);
  }

  changeButtonText() {
    const btn = document.getElementById('open');
    btn.innerText = 'å¿«å»ç™»å½•';
  }
}

const openButton = new OpenButton();
const decorator = new Decorator(openButton);

document.getElementById('open').addEventListener('click', function () {
  // openButton.onClick()
  // æ­¤å¤„å¯ä»¥åˆ†åˆ«å°è¯•ä¸¤ä¸ªå®ä¾‹çš„onClickæ–¹æ³•ï¼ŒéªŒè¯è£…é¥°å™¨æ˜¯å¦ç”Ÿæ•ˆ
  decorator.onClick();
});
```

## é€‚é…å™¨æ¨¡å¼

- å®šä¹‰ï¼šå°†åŸæ¥çš„é€»è¾‘å…¼å®¹æ–°é€»è¾‘

  ```js
  // Ajaxé€‚é…å™¨å‡½æ•°ï¼Œå…¥å‚ä¸æ—§æ¥å£ä¿æŒä¸€è‡´
  async function AjaxAdapter(type, url, data, success, failed) {
    const type = type.toUpperCase();
    let result;
    try {
      // å®é™…çš„è¯·æ±‚å…¨éƒ¨ç”±æ–°æ¥å£å‘èµ·
      if (type === 'GET') {
        result = (await HttpUtils.get(url)) || {};
      } else if (type === 'POST') {
        result = (await HttpUtils.post(url, data)) || {};
      }
      // å‡è®¾è¯·æ±‚æˆåŠŸå¯¹åº”çš„çŠ¶æ€ç æ˜¯1
      result.statusCode === 1 && success
        ? success(result)
        : failed(result.statusCode);
    } catch (error) {
      // æ•æ‰ç½‘ç»œé”™è¯¯
      if (failed) {
        failed(error.statusCode);
      }
    }
  }

  // ç”¨é€‚é…å™¨é€‚é…æ—§çš„Ajaxæ–¹æ³•
  async function Ajax(type, url, data, success, failed) {
    await AjaxAdapter(type, url, data, success, failed);
  }
  ```

## ä»£ç†æ¨¡å¼

- å®šä¹‰ï¼šé€šè¿‡åˆ›å»ºä»£ç†å¯¹è±¡æ¥æ‹¦æˆªè¡Œä¸ºï¼Œåœ¨æœ‰ä»£ç†å¯¹è±¡å¯¹ç›®æ ‡å¯¹è±¡è¿›è¡Œæ“ä½œè¡Œä¸º

```js
<div id="father">
  <a href="#">é“¾æ¥1å·</a>
  <a href="#">é“¾æ¥2å·</a>
  <a href="#">é“¾æ¥3å·</a>
  <a href="#">é“¾æ¥4å·</a>
  <a href="#">é“¾æ¥5å·</a>
  <a href="#">é“¾æ¥6å·</a>
</div>;
// è·å–çˆ¶å…ƒç´ 
const father = document.getElementById('father');

// ç»™çˆ¶å…ƒç´ å®‰è£…ä¸€æ¬¡ç›‘å¬å‡½æ•°
father.addEventListener('click', function (e) {
  // è¯†åˆ«æ˜¯å¦æ˜¯ç›®æ ‡å­å…ƒç´ 
  if (e.target.tagName === 'A') {
    // ä»¥ä¸‹æ˜¯ç›‘å¬å‡½æ•°çš„å‡½æ•°ä½“
    e.preventDefault();
    alert(`æˆ‘æ˜¯${e.target.innerText}`);
  }
});
```

## ç­–ç•¥æ¨¡å¼

- å®šä¹‰ï¼šå°†åŸå…ˆé€»è¾‘æŠ½ç¦»ï¼Œè§£è€¦ï¼Œé€šè¿‡å°è£…çš„æ–¹å¼ï¼Œå»è°ƒç”¨å¯¹åº”çš„é€»è¾‘å¤„ç†

```js
// å®šä¹‰ä¸€ä¸ªè¯¢ä»·å¤„ç†å™¨å¯¹è±¡
const priceProcessor = {
  pre(originPrice) {
    if (originPrice >= 100) {
      return originPrice - 20;
    }
    return originPrice * 0.9;
  },
  onSale(originPrice) {
    if (originPrice >= 100) {
      return originPrice - 30;
    }
    return originPrice * 0.8;
  },
  back(originPrice) {
    if (originPrice >= 200) {
      return originPrice - 50;
    }
    return originPrice;
  },
  fresh(originPrice) {
    return originPrice * 0.5;
  },
};

// è¯¢ä»·å‡½æ•°
function askPrice(tag, originPrice) {
  return priceProcessor[tag](originPrice);
}
```

## çŠ¶æ€æ¨¡å¼

- å®šä¹‰ï¼šå…è®¸ä¸€ä¸ªå¯¹è±¡åœ¨å…¶å†…éƒ¨çŠ¶æ€æ”¹å˜æ—¶æ”¹å˜å®ƒçš„è¡Œä¸ºï¼Œå¯ä»¥æŠŠå¤æ‚çš„åˆ¤æ–­é€»è¾‘ç®€åŒ–ã€‚

```js
class CoffeeMaker {
  constructor() {
    /**
    è¿™é‡Œç•¥å»å’–å•¡æœºä¸­ä¸å’–å•¡çŠ¶æ€åˆ‡æ¢æ— å…³çš„ä¸€äº›åˆå§‹åŒ–é€»è¾‘
  **/
    // åˆå§‹åŒ–çŠ¶æ€ï¼Œæ²¡æœ‰åˆ‡æ¢ä»»ä½•å’–å•¡æ¨¡å¼
    this.state = 'init';
    // åˆå§‹åŒ–ç‰›å¥¶çš„å­˜å‚¨é‡
    this.leftMilk = '500ml';
  }
  stateToProcessor = {
    that: this,
    american() {
      // å°è¯•åœ¨è¡Œä¸ºå‡½æ•°é‡Œæ‹¿åˆ°å’–å•¡æœºå®ä¾‹çš„ä¿¡æ¯å¹¶è¾“å‡º
      console.log('å’–å•¡æœºç°åœ¨çš„ç‰›å¥¶å­˜å‚¨é‡æ˜¯:', this.that.leftMilk);
      console.log('æˆ‘åªåé»‘å’–å•¡');
    },
    latte() {
      this.american();
      console.log('åŠ ç‚¹å¥¶');
    },
    vanillaLatte() {
      this.latte();
      console.log('å†åŠ é¦™è‰ç³–æµ†');
    },
    mocha() {
      this.latte();
      console.log('å†åŠ å·§å…‹åŠ›');
    },
  };

  // å…³æ³¨å’–å•¡æœºçŠ¶æ€åˆ‡æ¢å‡½æ•°
  changeState(state) {
    this.state = state;
    if (!this.stateToProcessor[state]) {
      return;
    }
    this.stateToProcessor[state]();
  }
}

const mk = new CoffeeMaker();
mk.changeState('latte');
```

## è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆçº¦ç­‰äºå‘å¸ƒ-è®¢é˜…æ¨¡å¼ï¼‰

- å®šä¹‰ï¼šå¼€å¯äº‹ä»¶æ—¶ï¼Œéœ€è¦é€šçŸ¥ç›¸å…³ä¾èµ–
- ä»£ç ï¼šå‚è€ƒ vue æºç çš„å“åº”å¼åŸç†

## è¿­ä»£å™¨æ¨¡å¼

- å®šä¹‰ï¼šæä¾›è¿­ä»£å™¨å»éå†å¯¹è±¡

```js
// for ..of ç­‰ä»·äºå¦‚ä¸‹ï¼š
// é€šè¿‡è°ƒç”¨iteratorï¼Œæ‹¿åˆ°è¿­ä»£å™¨å¯¹è±¡
const iterator = arr[Symbol.iterator]();

// åˆå§‹åŒ–ä¸€ä¸ªè¿­ä»£ç»“æœ
let now = { done: false };

// å¾ªç¯å¾€å¤–è¿­ä»£æˆå‘˜
while (!now.done) {
  now = iterator.next();
  if (!now.done) {
    console.log(`ç°åœ¨éå†åˆ°äº†${now.value}`);
  }
}
```
