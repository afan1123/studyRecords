# 计时器

## setInterval

### 累积效应

- 定时器代码执行之间的间隔可能比预期要小
- 定时器某些间隔被跳过

## setTimeout

- 真正执行代码的时间大于最小延迟时间

## setTimeout 和 setInterval 区别

- setTimeout 递归可以保障执行顺序
- setInterval 每次定时触发执行回调函数，不关心前一个回调函数是否执行

## requestAnimationFrame

- 告诉浏览器，执行一个动画，并且在下一次重绘之前执行指定的回调函数更新动画
- 执行次数与浏览器书信次数匹配，一般 1 秒 60 次
- 注意
  - 事件循环：1 个宏任务-->所有微任务-->是否需要渲染-->渲染 UI
  - requestAnimationFrame 其实就是在 ui 渲染中执行得
- 优点
  - dom 操作与浏览器刷新频率保持一致，保障动画流畅
  - 在隐藏或不可见元素中，requestAnimationFrame 将不进行重绘回流，节省 cpu，gpu
  - 页面不是激活状态，动画会自动暂停，节省 CPU 开销

## requestIdleCallback

- 将在浏览器空闲时间段调用函数排队

### 使用

- 低优先级的任务使用空闲回调
- 空闲回调尽量不超过可分配的时间
- 由于是在 render 之后，尽量避免在回调中改变 DOM
- 避免运行时间无法预测的任务
- 在需要的时候使用 timeout（timeout 会改变执行时机）
